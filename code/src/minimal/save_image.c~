#include <SDL2/SDL.h>
#include <SDL2/SDL_image.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include "save_image.h"



/**
 * Charge une image sous format JPG PNG
 * @param  path : le chemin absolut ou relatif vers l'image
 * @param  la composante renderer sur la quelle on veux chargé l'image
 * @return Une SDL_Texture modifiable qui contient l'image qu'on veux chargé  
 **/

int saveImage(SDL_Window* window, SDL_Renderer *renderer, char *name, char *format){

  int h,w,pitch;
  SDL_Surface *surface = NULL;
  Uint32 *pixels = NULL ; 
  
  SDL_GetWindowSize(window, &w , &h);
  pitch = sizeof(Uint32) * w ;
  pixels = malloc(pitch *h);
  SDL_RenderReadPixels(renderer, NULL, SDL_PIXELFORMAT_RGBA8888, pixels, pitch);
  surface = SDL_CreateRGBSurfaceWithFormatFrom(pixels,w,h,32,pitch,SDL_PIXELFORMAT_RGBA8888);


  if(strcmp(format, "bmp")==0){
    SDL_SaveBMP(surface,strcat(name,format));
    SDL_FreeSurface(surface);
  }else{
    if(strcmp(format,"png")==0){
      char *s=NULL;
      s=(char *)malloc((strlen(name)+strlen(format))*sizeof(char));
      strcpy(s,name);
      strcat(s,format);
      IMG_SavePNG(surface,s);
      SDL_FreeSurface(surface);
    }else{
      if(strcmp(format,"jpg")==0){
	printf("à venir");
	SDL_FreeSurface(surface);
      }else {

	return -1;
      }
    }
  }
  return 0;
}
